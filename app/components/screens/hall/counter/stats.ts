// export const visitsData = [
// 	{ time: '0:00', visits: 199 },
// 	{ time: '1:00', visits: 115 },
// 	{ time: '2:00', visits: 89 },
// 	{ time: '3:00', visits: 91 },
// 	{ time: '4:00', visits: 141 },
// 	{ time: '5:00', visits: 290 },
// 	{ time: '6:00', visits: 410 },
// 	{ time: '7:00', visits: 603 },
// 	{ time: '8:00', visits: 987 },
// 	{ time: '9:00', visits: 4069 },
// 	{ time: '10:00', visits: 5771 },
// 	{ time: '11:00', visits: 3305 },
// 	{ time: '12:00', visits: 2457 },
// 	{ time: '13:00', visits: 1896 },
// 	{ time: '14:00', visits: 1890 },
// 	{ time: '15:00', visits: 3164 },
// 	{ time: '16:00', visits: 2445 },
// 	{ time: '17:00', visits: 2627 },
// 	{ time: '18:00', visits: 2166 },
// 	{ time: '19:00', visits: 1488 },
// 	{ time: '20:00', visits: 1411 },
// 	{ time: '21:00', visits: 799 },
// 	{ time: '22:00', visits: 757 },
// 	{ time: '23:00', visits: 560 },
// ]
// 29 30 1 2 3 4 5 6

// export const visitsData = {
// 	'0:00': [0, 28, 199, 122, 83, 49, 97, 86, 78],
// 	'1:00': [0, 3, 92, 115, 34, 54, 48, 29, 48],
// 	'2:00': [0, 15, 89, 67, 31, 32, 23, 43, 13],
// 	'3:00': [0, 14, 91, 69, 35, 49, 42, 42, 33],
// 	'4:00': [0, 28, 141, 42, 59, 72, 32, 92, 22],
// 	'5:00': [0, 41, 290, 115, 66, 100, 61, 102, 51],
// 	'6:00': [0, 94, 410, 225, 107, 227, 126, 188, 161],
// 	'7:00': [0, 146, 603, 235, 253, 222, 171, 313, 131],
// 	'8:00': [0, 426, 987, 494, 292, 395, 305, 533, 199],
// 	'9:00': [0, 4069, 3469, 1850, 1420, 1736, 1643, 1208, 237],
// 	'10:00': [0, 5771, 2850, 1633, 1476, 1677, 3529, 1549, 328],
// 	'11:00': [0, 3305, 1434, 867, 847, 966, 1220, 920, 333],
// 	'12:00': [0, 2457, 1287, 1429, 776, 1309, 1019, 704, 356],
// 	'13:00': [0, 1896, 1049, 1814, 906, 1042, 716, 477, 364],
// 	'14:00': [0, 1890, 959, 778, 1147, 1127, 700, 474, 314],
// 	'15:00': [0, 3164, 1637, 499, 719, 909, 791, 452, 295],
// 	'16:00': [0, 2445, 1485, 446, 395, 1109, 566, 441, 407],
// 	'17:00': [0, 2627, 718, 481, 277, 631, 483, 382, 324],
// 	'18:00': [14, 2166, 646, 352, 266, 771, 402, 342, 276],
// 	'19:00': [37, 1458, 504, 294, 262, 1028, 399, 349, 209],
// 	'20:00': [35, 1411, 576, 274, 276, 474, 352, 316, 182],
// 	'21:00': [70, 799, 574, 247, 229, 455, 266, 181, 204],
// 	'22:00': [69, 757, 452, 200, 208, 355, 251, 216, 254],
// 	'23:00': [84, 560, 379, 231, 176, 254, 164, 113, 100],
// }

import { differenceInDays, getMinutes, parse } from 'date-fns'

const visitStats = [
	[500, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 5, 5, 10, 10, 12],
	[
		4, 0, 2, 2, 4, 6, 14, 21, 62, 593, 842, 482, 358, 277, 276, 461, 357, 383,
		316, 217, 206, 117, 110, 82,
	],
	[
		29, 13, 13, 13, 21, 42, 60, 88, 144, 506, 416, 209, 188, 153, 140, 239, 217,
		105, 94, 74, 84, 84, 66, 55,
	],
	[
		18, 17, 10, 10, 6, 17, 33, 34, 72, 270, 238, 126, 208, 265, 113, 73, 65, 70,
		51, 43, 40, 36, 29, 34,
	],
	[
		12, 5, 5, 5, 9, 10, 16, 37, 43, 207, 215, 124, 113, 132, 167, 105, 58, 40,
		39, 38, 40, 33, 30, 26,
	],
	[
		7, 8, 5, 7, 11, 15, 33, 32, 58, 253, 245, 141, 191, 152, 164, 133, 162, 92,
		112, 150, 69, 66, 52, 37,
	],
	[
		13, 4, 6, 6, 13, 15, 27, 46, 78, 240, 515, 178, 103, 70, 69, 66, 64, 56, 50,
		51, 46, 26, 32, 16,
	],
	[
		5, 3, 2, 5, 8, 8, 13, 17, 40, 54, 117, 121, 121, 94, 82, 93, 66, 65, 49, 50,
		45, 42, 33, 22,
	],
	[
		7, 4, 4, 4, 5, 11, 30, 30, 34, 56, 70, 65, 69, 66, 45, 48, 62, 48, 43, 34,
		35, 28, 19, 15,
	],
	[
		14, 7, 3, 6, 5, 9, 18, 25, 44, 176, 226, 134, 149, 104, 102, 115, 83, 70,
		59, 58, 51, 39, 37, 24,
	],
	[
		14, 7, 5, 1, 6, 6, 7, 21, 28, 27, 33, 33, 27, 23, 37, 27, 30, 28, 25, 27,
		26, 37, 24, 9,
	],
	[
		6, 4, 4, 1, 2, 2, 11, 8, 15, 20, 35, 38, 33, 29, 32, 28, 34, 38, 31, 27, 20,
		21, 17, 13,
	],
	[
		6, 5, 3, 2, 3, 7, 8, 23, 21, 28, 36, 41, 46, 50, 41, 43, 41, 27, 30, 27, 19,
		27, 19, 11,
	],
	[
		5, 2, 3, 5, 3, 4, 13, 15, 33, 45, 48, 33, 55, 51, 40, 32, 49, 35, 37, 40,
		27, 29, 19, 13,
	],
	[
		6, 3, 1, 1, 2, 8, 9, 17, 25, 42, 33, 44, 87, 73, 74, 64, 52, 57, 44, 47, 43,
		39, 38, 28,
	],
	[
		11, 7, 2, 5, 3, 7, 23, 19, 29, 34, 48, 49, 52, 53, 46, 43, 59, 47, 40, 30,
		27, 30, 37, 15,
	],
	[10, 7, 3, 1, 2, 3, 4, 8, 6, 8, 12, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
]

export const visitsData = {
	0: [0, 33, 229, 141, 95, 57, 112, 100, 90],
	1: [0, 4, 106, 133, 40, 63, 56, 34, 56],
	2: [0, 17, 109, 78, 36, 37, 27, 50, 15],
	3: [0, 17, 105, 80, 41, 57, 49, 49, 39],
	4: [0, 33, 163, 49, 68, 83, 37, 106, 26],
	5: [0, 48, 334, 133, 77, 116, 71, 118, 59],
	6: [0, 109, 472, 259, 124, 262, 146, 217, 186],
	7: [0, 169, 694, 271, 291, 256, 197, 362, 151],
	8: [0, 491, 1136, 569, 337, 455, 351, 615, 229],
	9: [0, 4684, 4000, 2123, 1633, 1991, 1886, 1389, 274],
	10: [0, 6658, 3281, 1878, 1698, 1927, 4064, 1782, 378],
	11: [0, 3802, 1656, 998, 976, 1111, 1404, 1059, 384],
	12: [0, 2826, 1482, 1649, 895, 1506, 1173, 810, 411],
	13: [0, 2181, 1208, 2087, 1043, 1194, 825, 551, 419],
	14: [0, 2174, 1104, 897, 1325, 1296, 805, 546, 362],
	15: [0, 3633, 1883, 575, 827, 1047, 911, 520, 340],
	16: [0, 2813, 1708, 515, 455, 1277, 651, 508, 469],
	17: [0, 3022, 827, 554, 320, 725, 556, 440, 373],
	18: [21, 2491, 744, 406, 306, 887, 463, 394, 318],
	19: [43, 1672, 580, 339, 302, 1183, 459, 402, 241],
	20: [41, 1625, 663, 317, 318, 546, 405, 364, 210],
	21: [81, 919, 661, 285, 264, 524, 306, 209, 235],
	22: [80, 872, 521, 230, 240, 409, 289, 249, 293],
	23: [97, 644, 437, 267, 203, 293, 189, 130, 116],
}

function calculateSum(d: number, h: number) {
	// Проверяем корректность входных данных
	const day = d > 17 ? 17 : d
	const hour = h > 23 ? 23 : h

	let sum = 0

	// Проходим по всем строкам от начала до строки i
	for (let row = 0; row < day; row++) {
		// Проходим по всем столбцам в текущей строке
		for (let col = 0; col < visitStats[row].length; col++) {
			sum += visitStats[row][col]
		}
	}

	const dStats = visitStats.at(day) || []
	dStats.forEach((stat, idx) => {
		if (idx <= hour) {
			sum += stat
		}
	})

	return sum
}

export const getVisitValue = (hour: string | number, day: string) => {
	const dayIndex = getDayIndex(day)
	const hourNum = typeof hour === 'string' ? parseInt(hour) : hour
	const minutes = getMinutes(new Date())

	const nextDayIndex = hourNum == 23 ? dayIndex + 1 : dayIndex
	const nextDayHourNum = hourNum == 23 ? 0 : hourNum + 1

	const val = calculateSum(dayIndex, hourNum)
	const nextVal = calculateSum(nextDayIndex, nextDayHourNum)
	const counter = val + Math.round((nextVal - val) * (minutes / 60))
	// (значение следующего часа - значение этого часа) / 60 / 4

	return {
		current: counter,
	}
}

const getNextHour = (hour: number) => {
	if (hour > 23) return 23
	if (hour == 9) return 9
	return hour
}

const getValidHour = (hour: number) => {
	if (hour < 0) return 0
	if (hour > 23) return 23
	return hour
}

const getDayIndex = (day: string) => {
	const start = parse('29.11', 'dd.MM', new Date())
	const end = parse(day, 'dd.MM', new Date())
	return differenceInDays(end, start) || 3
}
